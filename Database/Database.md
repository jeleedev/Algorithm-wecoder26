# Database

**📚 Contents**

- Trigger
- Transaction
- Join

---

## Transaction

### 트랜잭션(Transaction)이란?

트랜잭션(Transaction)은 데이터베이스 상태를 변화시키는 하나의 논리적 기능을 수행하기 위한 작업의 단위 또는 한꺼번에 수행되어야 할 일련의 연산들을 의미합니다.

만약 논리적인 작업을 모두 완벽하게 처리하거나 또는 처리하지 못할 경우에는 원 상태로 복구하여 작업의 일부만 적용되는 현상이 발생하지 않게 작업의 안정성을 보장해주는 기능입니다.

### 트랜잭션의 특성

트랜잭션은 원자성, 일관성, 독립성, 영속성 총 4가지이며 줄여서 ACID라고도 합니다.

**원자성(Atomicity)**

트랜잭션의 연산은 데이터베이스에 모두 반영되든지 아니면 전혀 반영되지 않아야 합니다.

**일관성(Consistency)**

트랜잭션의 작업 처리 결과가 항상 일관성이 있어야 합니다. 트랜잭션이 진행되는 동안에 데이터베이스가 변경되더라도 업데이트된 데이터베이스로 트랜잭션이 진행되는 것이 아니라, 처음에 트랜잭션을 진행하기 위해 참조한 데이터베이스로 진행됩니다. 이렇게 함으로써 각 사용자들은 일관성 있는 데이터를 볼 수 있습니다.

**독립성(Isolation)**

트랜잭션이 실행되고 있을 때, 다른 트랜잭션의 연산작업이 중간에 끼어들지 못하게 하여 기존 작업에 영향을 주지 못하도록 합니다. 실행중인 트랜잭션은 완전히 완료될 때까지 다른 트랜잭션에서 결과를 참조할 수 없습니다.

**영속성(Durablility)**

성공적으로 실행된 트랜잭션은 데이터베이스에 영구적으로 반영되어야 합니다.

### 트랜잭션의 상태

**활동(Active)**

트랜잭션의 활동 상태. 트랜잭션이 실행중이며 동작중인 상태.

**실패(Failed)**

트랜잭션 실패 상태. 트랜잭션이 더이상 정상적으로 진행할 수 없는 상태.

**부분 완료(Partially Committed)**

트랜잭션의 Commit 명령이 도착한 상태. 트랜잭션의 commit이전 sql문이 수행되고 commit만 남은 상태.

**철회(Aborted)**

트랜잭션이 취소 상태. 트랜잭션이 취소되고 트랜잭션 실행 이전 데이터로 돌아간 상태.

**완료(Committed)**

트랜잭션 완료 상태. 트랜잭션이 정상적으로 완료된 상태

```
**Partially Committed 와 Committed 의 차이점**

Commit 요청이 들어오면 상태는 Partial Commited 상태가 됩니다. 이후 Commit을 문제없이 수행할 수 있으면 Committed 상태로 전이되고, 만약 오류가 발생하면 Failed 상태가 됩니다. 즉, Partial Commited는 Commit 요청이 들어왔을 때를 말하며, Commited는 Commit을 정상적으로 완료한 상태를 말합니다.
```

```
**트랜잭션을 사용할 때 주의할 점**

트랜잭션은 꼭 필요한 최소의 코드에만 적용하는 것이 좋습니다. 즉 트랜잭션의 범위를 최소화하라는 것. 일반적으로 데이터베이스 커넥션은 개수가 제한적입니다. 그런데 각 단위 프로그램이 커넥션을 소유하는 시간이 길어진다면 사용 가능한 여유 커넥션의 개수는 줄어들게 되고 그러다 어느 순간에는 각 단위 프로그램에서 커넥션을 가져가기 위해 기다려야 하는 상황이 발생할 수도 있습니다.
```

```
**독립성과 무결성**
독립성을 보장하기 위해 모든 트랜잭션을 순차적으로 실행한다면 동시성 처리 이슈가 발생할 수 있습니다.
반대로 동시성 처리를 높이기 위해 트랜잭션을 병렬처리하게 되면 데이터의 무결성이 깨질 수 있습니다.

1. Dirty Read
한 트랜잭션(T1)이 데이터에 접근해서 A라는 값을 B로바꾸고 커밋하지 않았을때, 다른 트랜잭션(T2)이 같은 데이터에 접근하여 데이터를 READ하면 T2가 읽은 데이터는 B가 된다. T1이 커밋을 실패하게 된다면 T2의 데이터는 망가지게 된다.

2. Non-Repeatable Read
한 트랜잭션(T1)이 데이터를 Read하고 있을때 다른 트랜잭션(T2)가 T1이 접근하는 데이터를 변경 혹은 삭제한다면 T1은 사라진 데이터 혹은 변경된 데이터를 찾게 된다.

3. Phantom Read
트랜잭션(T1)이 특정 조건으로 데이터를 검색하여 결과를 얻었을때, 다른 트랜잭션(T2)가 접근해 해당 조건의 데이터를 일부 삭제 혹은 추가했을때, 아직 끝나지 않은 T1 트랜잭션이 다시 해당조건으로 데이터를 조회하면 T2에서 추가/삭제한 데이터가 함께 조회/누락 된다. 이후 T2가 롤백을 하게된다면 데이터가 꼬이게 된다.
```
